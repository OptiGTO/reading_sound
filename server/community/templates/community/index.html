<!-- File: community/templates/community/index.html -->
{% extends "community/base.html" %}
{% load static %}

{% block title %}í™ˆ{% endblock %}

{% block content %}

<section class="section active" id="home-section">
  <h2>í™ˆ í™”ë©´</h2>
  <div class="post-bulletin-nav">
    <button class="btn hover-effect sub-link active" data-subsection="home-full-board">
      <i class="fas fa-th-large"></i> ì „ì²´
    </button>
    <button class="btn hover-effect sub-link" data-subsection="home-essay-board">
      <i class="fas fa-pencil-alt"></i> ì—ì„¸ì´
    </button>
    <button class="btn hover-effect sub-link" data-subsection="home-novel-board">
      <i class="fas fa-book"></i> ì†Œì„¤
    </button>
    <button class="btn hover-effect sub-link" data-subsection="home-poetry-board">
      <i class="fas fa-feather-alt"></i> ì‹œ
    </button>
    <button class="btn hover-effect sub-link" data-subsection="home-nonlit-board">
      <i class="fas fa-newspaper"></i> ë¹„ë¬¸í•™
    </button>
  </div>
  
  <div id="home-board-container">
    <!-- 1) ì „ì²´ ê²Œì‹œíŒ -->
    <section class="sub-section active" id="home-full-board">
      <h3>ì „ì²´ ê²Œì‹œíŒ</h3>
      <div class="home-grid-container">
        
        {% for book in books %}
        <div class="home-grid-item" 
          data-description="{{ book.description|default:'ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤.' }}"
          data-publisher="{{ book.publisher|default:'ì¶œíŒì‚¬ ì •ë³´ ì—†ìŒ' }}"
          data-pubdate="{{ book.pubdate|default:'ì¶œíŒì¼ ì •ë³´ ì—†ìŒ' }}"
          data-isbn="{{ book.isbn|default:'ISBN ì •ë³´ ì—†ìŒ' }}"
          data-thumbnail="{{ book.thumbnail_url|default_if_none:"{% static 'community/images/book_placeholder.png' %}" }}"
          onclick="showBookPosts('{{ book.isbn }}', '{{ book.title|escapejs }}', this.dataset.thumbnail)">
        <img src="{{ book.thumbnail_url|default_if_none:'{% static "community/images/book_placeholder.png" %}' }}" 
            alt="{{ book.title }}" 
            class="grid-image">
        <div class="grid-info">
          <h4>{{ book.title }}</h4>
          <p>{{ book.author }}</p>
        </div>
        <!-- í˜¸ë²„ ì‹œ ë‚˜íƒ€ë‚  ì˜¤ë²„ë ˆì´ -->
        <div class="overlay-info">
          <div class="info-item">
            <i class="fas fa-music"></i> {{ book.likes }}
          </div>
          <div class="info-item">
            <i class="fas fa-book"></i> {{ book.post_count }}
          </div>
        </div>
      </div>
      {% endfor %}
      </div>
    </section>

    <!-- 2) ì—ì„¸ì´ ê²Œì‹œíŒ -->

    <section class="sub-section" id="home-essay-board">
      <h3>ì—ì„¸ì´ ê²Œì‹œíŒ</h3>
        <div class="home-grid-container">
          
        </div>

      
    </section>

    <!-- 3) ì†Œì„¤ ê²Œì‹œíŒ -->
    <section class="sub-section" id="home-novel-board">
      <h3>ì†Œì„¤ ê²Œì‹œíŒ</h3>
      <div class="home-grid-container">
          
      </div>
        
      
    </section>

    <!-- 4) ì‹œ ê²Œì‹œíŒ -->
    <section class="sub-section" id="home-poetry-board">
      <h3>ì‹œ ê²Œì‹œíŒ</h3>
      <div class="home-grid-container">
          
      </div>
        
      
    </section>

    <!-- 5) ë¹„ë¬¸í•™ ê²Œì‹œíŒ -->
    <section class="sub-section" id="home-nonlit-board">
      <h3>ë¹„ë¬¸í•™ ê²Œì‹œíŒ</h3>
      <div class="home-grid-container">
          
      </div>
        
      </section>
    </section>
  </div> <!-- #home-board-container ë -->
</section>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const cards = document.querySelectorAll('.home-grid-item');
  const rightSidebar = document.querySelector('.right-sidebar');
  if (!rightSidebar) return;
  
  // ì´ˆê¸° ì‚¬ì´ë“œë°” ë‚´ìš©ì„ ì €ì¥
  const originalSidebarContent = rightSidebar.innerHTML;
  let hoverTimer;
  let isHovered = false;

  cards.forEach(card => {
    card.addEventListener('mouseenter', () => {
      isHovered = true;
      hoverTimer = setTimeout(() => {
        if (!isHovered) return;
        
        const thumbnail = card.querySelector('img').src;
        rightSidebar.innerHTML = `
          <h3>ğŸ“– ì±… ìƒì„¸ ì •ë³´</h3>
          <div class="book-detail">
            <img src="${thumbnail}" 
                 alt="${card.querySelector('h4').textContent}" 
                 class="book-thumbnail">
            <div class="book-info">
              <p class="publisher"><strong>ì¶œíŒì‚¬:</strong> ${card.dataset.publisher || 'ì •ë³´ ì—†ìŒ'}</p>
              <p class="pubdate"><strong>ì¶œíŒì¼:</strong> ${card.dataset.pubdate || 'ì •ë³´ ì—†ìŒ'}</p>
              <p class="isbn"><strong>ISBN:</strong> ${card.dataset.isbn || 'ì •ë³´ ì—†ìŒ'}</p>
              <p class="description"><strong>ì„¤ëª…:</strong> ${card.dataset.description || 'ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤.'}</p>
            </div>
          </div>
        `;
        rightSidebar.classList.add('book-info-active', 'show');
      }, 300);
    });
    
    card.addEventListener('mouseleave', () => {
      isHovered = false;
      clearTimeout(hoverTimer);
      
      // ë¶€ë“œëŸ¬ìš´ ì „í™˜ì„ ìœ„í•œ íƒ€ì´ë° ì¡°ì •
      setTimeout(() => {
        if (!isHovered) {
          rightSidebar.classList.remove('show');
          
          // í˜ì´ë“œ ì•„ì›ƒ íš¨ê³¼ í›„ ì›ë˜ ë‚´ìš©ìœ¼ë¡œ ë³µì›
          setTimeout(() => {
            if (!isHovered) {
              rightSidebar.classList.remove('book-info-active');
              rightSidebar.innerHTML = originalSidebarContent;
            }
          }, 300);  // show í´ë˜ìŠ¤ê°€ ì œê±°ëœ í›„ ë‚´ìš© ë³€ê²½
        }
      }, 200);
    });
  });
});
</script>

{% endblock %}