<!-- community/templates/community/general_post_detail.html -->     
{% extends "community/base.html" %}                                <!-- ë² ì´ìŠ¤ í…œí”Œë¦¿ í™•ì¥  // í™•ì¥ -->
{% load static %}                                                  <!-- ìŠ¤íƒœí‹± íŒŒì¼ ë¡œë“œ  // ìŠ¤íƒœí‹± íŒŒì¼ ë¡œë“œ -->
{% load comment_tags %}  <!-- ì¶”ê°€: comment_tags ë¡œë“œ -->

{% block title %}{{ post.title }}{% endblock %}                    <!-- í˜ì´ì§€ ì œëª©ì— ê²Œì‹œê¸€ ì œëª© ì‚¬ìš©  // ì œëª© ì‚¬ìš© -->

{% block content %}
<article class="post-detail">                                       <!-- ê²Œì‹œê¸€ ìƒì„¸ ì •ë³´ ì˜ì—­  // ê²Œì‹œê¸€ ìƒì„¸ ì˜ì—­ -->
  <h1>{{ post.title }}</h1>                                           <!-- ê²Œì‹œê¸€ ì œëª© ì¶œë ¥  // ì œëª© ì¶œë ¥ -->
  <p>ì‘ì„±ì: {{ post.writer.username }}</p>                           <!-- ì‘ì„±ì ì •ë³´ ì¶œë ¥  // ì‘ì„±ì ì¶œë ¥ -->
  <div class="post-content">
    {{ post.content|safe }}                                           <!-- ë‚´ìš© ë Œë”ë§ (HTML í—ˆìš©)  // ë‚´ìš© ì¶œë ¥ -->
  </div>
  
  <!-- ê´€ë ¨ ì´ë¯¸ì§€ ì¶œë ¥ (ìˆëŠ” ê²½ìš°)  // ì´ë¯¸ì§€ ì¶œë ¥ -->
  {% if post.postimage_set.all %}
    <div class="post-images">
      {% for image in post.postimage_set.all %}
        <img src="{{ image.image.url }}" alt="ê²Œì‹œê¸€ ì´ë¯¸ì§€" style="max-width: 300px;">  <!-- ì´ë¯¸ì§€ íƒœê·¸  // ì´ë¯¸ì§€ íƒœê·¸ -->
      {% endfor %}
    </div>
  {% endif %}

  <!-- ì¢‹ì•„ìš”(í•˜ëª¨ë‹ˆ) ë²„íŠ¼  // ì¢‹ì•„ìš” ë²„íŠ¼ -->
  <div class="like-container" style="margin-top:20px;">             <!-- ë²„íŠ¼ ê°ì‹¸ëŠ” ì˜ì—­  // ê°ì‹¸ëŠ” ì˜ì—­ -->
    <button id="like-btn" 
            data-post-id="{{ post.id }}" 
            data-model="GeneralPost"> 
      ğŸµ í•˜ëª¨ë‹ˆ(ì¢‹ì•„ìš”) <span id="like-count">{{ post.likes }}</span>  <!-- ì•„ì´ì½˜ ë° ì¢‹ì•„ìš” ìˆ˜  // ì¢‹ì•„ìš” ìˆ˜ -->
    </button>
  </div>
  
  <a href="{% url 'community:home' %}" class="btn hover-effect">ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>   <!-- ëª©ë¡ ë³µê·€ ë²„íŠ¼  // ë³µê·€ ë²„íŠ¼ -->
</article>

<hr>                                                                    <!-- êµ¬ë¶„ì„  ì¶”ê°€  // êµ¬ë¶„ì„  -->

<!-- ëŒ“ê¸€ ì„¹ì…˜ -->
<section class="comments-section">
  <h2>ëŒ“ê¸€</h2>

  <!-- ëŒ“ê¸€ ì…ë ¥ í¼ -->
  <form method="post" action="">
    {% csrf_token %}
    {{ comment_form.as_p }}
    <button type="submit" class="btn btn-primary">ëŒ“ê¸€ ì‘ì„±</button>
  </form>

  <!-- ëŒ“ê¸€ ëª©ë¡ (ì¬ê·€ì  ì¶œë ¥) -->
  {% if comments %}
    {% for comment in comments %}
      {% include "community/includes/comment.html" with comment=comment post=post comment_form=comment_form %}
    {% endfor %}
  {% else %}
    <p>ì‘ì„±ëœ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
  {% endif %}
</section>

<!-- ìŠ¤í¬ë¦½íŠ¸ë¥¼ content ë¸”ë¡ ì•ˆìœ¼ë¡œ ì´ë™ -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // ë‹µê¸€ í† ê¸€ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
    function handleReplyToggle(e) {
        e.preventDefault();
        e.stopPropagation();
        
        const commentId = e.target.dataset.commentId;
        const replyForm = document.getElementById(`reply-form-${commentId}`);
        
        if (replyForm) {
            // ë‹¤ë¥¸ ëª¨ë“  ë‹µê¸€ í¼ì„ ë‹«ìŒ
            document.querySelectorAll('.reply-form').forEach(form => {
                if (form !== replyForm) {
                    form.style.display = 'none';
                }
            });
            
            // í˜„ì¬ í¼ í† ê¸€
            replyForm.style.display = replyForm.style.display === 'none' || replyForm.style.display === '' ? 'block' : 'none';
        }
    }

    // ëŒ“ê¸€ ì˜ì—­ í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
    function handleCommentClick(e) {
        // ë‹µê¸€ ë²„íŠ¼ì´ë‚˜ í¼ ë‚´ë¶€ í´ë¦­ì€ ë¬´ì‹œ
        if (e.target.closest('.reply-toggle') || e.target.closest('.reply-form')) {
            return;
        }
        
        e.stopPropagation();
        
        // ë‹¤ë¥¸ ì„ íƒëœ ëŒ“ê¸€ í•´ì œ
        document.querySelectorAll('.comment.selected').forEach(c => {
            if (c !== this) {
                c.classList.remove('selected');
            }
        });
        
        // í˜„ì¬ ëŒ“ê¸€ ì„ íƒ
        this.classList.add('selected');
    }

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
    function initializeEventListeners() {
        // ë‹µê¸€ í† ê¸€ ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        document.querySelectorAll('.reply-toggle').forEach(button => {
            button.addEventListener('click', handleReplyToggle);
        });

        // ëŒ“ê¸€ ì˜ì—­ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        document.querySelectorAll('.comment').forEach(comment => {
            comment.addEventListener('click', handleCommentClick);
        });
    }

    // ì´ˆê¸°í™” ì‹¤í–‰
    initializeEventListeners();
});
</script>
{% endblock %}